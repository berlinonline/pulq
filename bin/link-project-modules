#!/bin/bash

GIT_PATH=".git";
BASEDIR=`readlink -f "$( dirname $0 )/.."`
PWD=`pwd`

if [ -f "$GIT_PATH" ]; then
    # the .git of the submodule is a file
    # let's read the actual pat hof the .git directory from it.
    GIT_PATH=`cat "$GIT_PATH" | sed "s/gitdir: //"`;
fi

INFO_DIR="$GIT_PATH/info";

if [ ! -d "$INFO_DIR" ]; then
   mkdir -p "$INFO_DIR";
fi

EXCLUDE_FILE_PATH="$INFO_DIR/exclude";

cd $BASEDIR
MODULE_DIR="../project/modules/"
for MODULE in `ls $MODULE_DIR`; do
    echo "Linking $MODULE_DIR$MODULE -> app/modules/$MODULE"
    ln -s "../../$MODULE_DIR$MODULE" "app/modules/$MODULE"

    if ! grep -Fxq "app/modules/$MODULE" $EXCLUDE_FILE_PATH
    then
        # code if found
        echo "app/modules/$MODULE" >> "$EXCLUDE_FILE_PATH"
    fi
done
cd $PWD

echo -e "\033[32mExluded from git in $EXCLUDE_FILE_PATH:\033[39m"
echo "`cat $EXCLUDE_FILE_PATH`"

