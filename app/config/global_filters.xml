<?xml version="1.0" encoding="UTF-8"?>
<ae:configurations 
    xmlns:ae="http://agavi.org/agavi/config/global/envelope/1.0" 
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns="http://agavi.org/agavi/config/parts/filters/1.0">

    <!--
        Fix ESI filter
        When using ESI includes (not relying on the ESI filter) and FPF you will need 
        to enable the FixESI filter to restore the <esi:include /> tag.
        The FixESI filter needs to wrap the FPF, so its declaration comes first.

        The config beneath is let here just as template
    -->
    <!--
    <ae:configuration context="web">
        <filters>
            <filter name="FixEsiFilter"  class="Pulq\Agavi\Filter\FixEsiFilter" enabled="true">
                <ae:parameter name="output_types">
                    <ae:parameter>html</ae:parameter>
                </ae:parameter>
            </filter>
        </filters>
    </ae:configuration>
    -->

    <ae:configuration context="web">
        <filters>
            <filter name="ResourceFilter" class="Pulq\Agavi\Filter\ResourceFilter">
                <ae:parameter name="output_types">
                    <ae:parameter>html</ae:parameter>
                </ae:parameter>
                <ae:parameter name="base_dir">%core.app_dir%/../pub/static/</ae:parameter>
                <!-- 
                    defines whether the deploy or the cache directory is used. 
                    use true for development and false for production. 
                    make sure to deploy and commit your latest scripts: `make deploy-resources`
                -->
                <ae:parameter name="use_caching">true</ae:parameter>
                <ae:parameter name="combine_scripts">off</ae:parameter>
                <ae:parameter name="compress_scripts">off</ae:parameter>
            </filter>
            <!--
                Form Population filter
                    it should be defined in the specific project global_filter.xml (see XInclude beneath).
                    This will allow more freedom in the configuration, when is needed to wrap the FPF into
                    another filter (as in the case of the FixESI filter).

                    The config beneath is let here just as template
            -->
            <!--
            <filter name="FormPopulationFilter" class="AgaviFormPopulationFilter">
                <ae:parameter name="methods">
                    <ae:parameter>write</ae:parameter>
                </ae:parameter>
                <ae:parameter name="output_types">
                    <ae:parameter>html</ae:parameter>
                </ae:parameter>
                <ae:parameter name="force_output_mode">xhtml</ae:parameter>
                <ae:parameter name="field_error_messages">
                    <ae:parameter name="parent::${htmlnsPrefix}dd">
                        <ae:parameter name="location">after</ae:parameter>
                        <ae:parameter name="container"><![CDATA[<dd>${errorMessages}</dd>]]>
                        </ae:parameter>
                        <ae:parameter name="markup"><![CDATA[<p class="error">${errorMessage}</p>]]>
                        </ae:parameter>
                    </ae:parameter>
                </ae:parameter>
                <ae:parameter name="savexml_options">LIBXML_NOEMPTYTAG</ae:parameter>
            </filter>
            -->
        </filters>
    </ae:configuration>

    <ae:configuration context="web" environment="stage|production">
        <filters>
            <filter name="ResourceFilter" class="Pulq\Agavi\Filter\ResourceFilter">
                <ae:parameter name="output_types">
                    <ae:parameter>html</ae:parameter>
                </ae:parameter>
                <ae:parameter name="base_dir">%core.app_dir%/../pub/static/</ae:parameter>
                <ae:parameter name="use_caching">false</ae:parameter>
                <ae:parameter name="combine_scripts">on</ae:parameter>
                <ae:parameter name="compress_scripts">on</ae:parameter>
            </filter>
        </filters>
    </ae:configuration>

    <xi:include href="%core.app_dir%/project/config/global_filters.xml"
        xpointer="xmlns(ae=http://agavi.org/agavi/config/global/envelope/1.0) xpointer(/ae:configurations/*)">
        <xi:fallback />
    </xi:include>
</ae:configurations> 
